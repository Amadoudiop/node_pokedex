{"version":3,"sources":["../../../server/routes/Users.js"],"names":["express","require","User","encrypter","errorManager","passwordGenerator","router","Router","getUsers","req","res","find","then","json","result","catch","error500","err","getUser","findById","params","id","user","status","send","createUser","p","body","console","log","password","generatePassword","encrypt","newUser","save","editUser","name","email","pokemon","deleteUser","findByIdAndRemove","response","message","_id","addPokemonToUser","pokemonsCapture","push","getPokemonsUser","getPokemonUser","filter","pokemonCapture","idpokemon","patchPokemonUser","pokemonToChange","pokemonName","pokemonType","niveau","img","deletePokemonUser","indexPokemon","findIndex","get","post","put","delete","patch","module","exports"],"mappings":";;AAAA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA;AACA,IAAMC,OAAOD,QAAQ,gBAAR,CAAb;AACA,IAAME,YAAYF,QAAQ,uBAAR,CAAlB;AACA,IAAMG,eAAeH,QAAQ,8BAAR,CAArB;AACA,IAAMI,oBAAoBJ,QAAQ,gCAAR,CAA1B;;AAEA,IAAMK,SAASN,QAAQO,MAAR,EAAf;;AAEA,IAAMC,WAAW,SAAXA,QAAW,CAACC,GAAD,EAAMC,GAAN,EAAc;AAC3BR,SAAKS,IAAL,GACKC,IADL,CACU;AAAA,eAAUF,IAAIG,IAAJ,CAASC,MAAT,CAAV;AAAA,KADV,EAEKC,KAFL,CAEW;AAAA,eAAOX,aAAaY,QAAb,CAAsBN,GAAtB,EAA2BO,GAA3B,CAAP;AAAA,KAFX;AAGH,CAJD;;AAMA,IAAMC,UAAU,SAAVA,OAAU,CAACT,GAAD,EAAMC,GAAN,EAAc;AAC1BR,SAAKiB,QAAL,CAAcV,IAAIW,MAAJ,CAAWC,EAAzB,EAA6B,UAACJ,GAAD,EAAMK,IAAN,EAAe;AACxC,YAAIL,GAAJ,EAAS;AACLP,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBP,GAArB;AACH;AACD,YAAIK,IAAJ,EAAU;AACNZ,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,IAArB;AACH,SAFD,MAEO;AACHZ,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,4BAArB;AACH;AACJ,KATD;AAUH,CAXD;;AAaA,IAAMC,aAAa,SAAbA,UAAa,CAAChB,GAAD,EAAMC,GAAN,EAAc;AAC7B,QAAMgB,IAAIjB,IAAIkB,IAAd;AACA,QAAGlB,GAAH,EAAQmB,QAAQC,GAAR,CAAYpB,IAAIkB,IAAhB;AACR,QAAMG,WAAWzB,kBAAkB0B,gBAAlB,CAAmC,EAAnC,CAAjB;AACAL,MAAEI,QAAF,GAAa3B,UAAU6B,OAAV,CAAkBF,QAAlB,CAAb;AACA,QAAMG,UAAU,IAAI/B,IAAJ,CAASwB,CAAT,CAAhB;AACAO,YAAQC,IAAR,GAAetB,IAAf,CAAoB,UAACU,IAAD,EAAU;AAC1BZ,YAAIG,IAAJ,CAASS,IAAT;AACH,KAFD,EAEGP,KAFH,CAES;AAAA,eAAOX,aAAaY,QAAb,CAAsBN,GAAtB,EAA2BO,GAA3B,CAAP;AAAA,KAFT;AAGH,CATD;;AAWA,IAAMkB,WAAW,SAAXA,QAAW,CAAC1B,GAAD,EAAMC,GAAN,EAAc;AAC3BR,SAAKiB,QAAL,CAAcV,IAAIW,MAAJ,CAAWC,EAAzB,EAA6B,UAACJ,GAAD,EAAMf,IAAN,EAAe;AACxC,YAAIe,GAAJ,EAAS;AACLP,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBP,GAArB;AACH,SAFD,MAEO;AACHf,iBAAKkC,IAAL,GAAY3B,IAAIkB,IAAJ,CAASS,IAAT,IAAiBd,KAAKc,IAAlC;AACAlC,iBAAKmC,KAAL,GAAa5B,IAAIkB,IAAJ,CAASU,KAAT,IAAkBf,KAAKe,KAApC;AACAnC,iBAAK4B,QAAL,GAAgBrB,IAAIkB,IAAJ,CAASG,QAAT,IAAqBR,KAAKQ,QAA1C;;AAEA5B,iBAAKgC,IAAL,CAAU,UAACjB,GAAD,EAAMqB,OAAN,EAAkB;AACxB,oBAAIrB,GAAJ,EAAS;AACLP,wBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBP,GAArB;AACH;AACDP,oBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBc,OAArB;AACH,aALD;AAMH;AACJ,KAfD;AAgBH,CAjBD;;AAmBA,IAAMC,aAAa,SAAbA,UAAa,CAAC9B,GAAD,EAAMC,GAAN,EAAc;AAC7BR,SAAKsC,iBAAL,CAAuB/B,IAAIW,MAAJ,CAAWC,EAAlC,EAAsC,UAACJ,GAAD,EAAMK,IAAN,EAAe;AACjD,YAAImB,WAAW;AACXC,qBAAS,2BADE;AAEXrB,gBAAIC,KAAKqB;AAFE,SAAf;AAIAjC,YAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBiB,QAArB;AACH,KAND;AAOH,CARD;;AAUA,IAAMG,mBAAmB,SAAnBA,gBAAmB,CAACnC,GAAD,EAAMC,GAAN,EAAc;AACnC,QAAMgB,IAAIjB,IAAIkB,IAAd;AACAzB,SAAKiB,QAAL,CAAcV,IAAIW,MAAJ,CAAWC,EAAzB,EAA6B,UAACJ,GAAD,EAAMf,IAAN,EAAe;AACxC,YAAIe,GAAJ,EAAS;AACLP,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBP,GAArB;AACH,SAFD,MAEO;AACHf,iBAAK2C,eAAL,CAAqBC,IAArB,CAA0BrC,IAAIkB,IAAJ,CAASkB,eAAnC;AACA3C,iBAAKgC,IAAL,CAAU,UAACjB,GAAD,EAAMqB,OAAN,EAAkB;AACxB,oBAAIrB,GAAJ,EAAS;AACLP,wBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBP,GAArB;AACH;AACDP,oBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBc,OAArB;AACH,aALD;AAMH;AACJ,KAZD,EAYGvB,KAZH,CAYS;AAAA,eAAOX,aAAaY,QAAb,CAAsBN,GAAtB,EAA2BO,GAA3B,CAAP;AAAA,KAZT;AAaH,CAfD;;AAiBA,IAAM8B,kBAAkB,SAAlBA,eAAkB,CAACtC,GAAD,EAAMC,GAAN,EAAc;AAClCR,SAAKiB,QAAL,CAAcV,IAAIW,MAAJ,CAAWC,EAAzB,EAA6B,UAACJ,GAAD,EAAMK,IAAN,EAAe;AACxC,YAAIL,GAAJ,EAAS;AACLP,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBP,GAArB;AACH;AACD,YAAIK,IAAJ,EAAU;AACNZ,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,KAAKuB,eAA1B;AACH,SAFD,MAEO;AACHnC,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,+BAArB;AACH;AACJ,KATD;AAUH,CAXD;AAYA,IAAMwB,iBAAiB,SAAjBA,cAAiB,CAACvC,GAAD,EAAMC,GAAN,EAAc;AACjCR,SAAKiB,QAAL,CAAcV,IAAIW,MAAJ,CAAWC,EAAzB,EAA6B,UAACJ,GAAD,EAAMK,IAAN,EAAe;AACxC,YAAIL,GAAJ,EAAS;AACLP,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBP,GAArB;AACH;AACD,YAAIK,IAAJ,EAAU;AACNZ,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,KAAKuB,eAAL,CAAqBI,MAArB,CAA6B;AAAA,uBAAkBC,eAAeP,GAAf,IAAsBlC,IAAIW,MAAJ,CAAW+B,SAAnD;AAAA,aAA7B,CAArB;AACH,SAFD,MAEO;AACHzC,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,+BAArB;AACH;AACJ,KATD;AAUH,CAXD;;AAaA,IAAM4B,mBAAmB,SAAnBA,gBAAmB,CAAC3C,GAAD,EAAMC,GAAN,EAAc;AACnCR,SAAKiB,QAAL,CAAcV,IAAIW,MAAJ,CAAWC,EAAzB,EAA6B,UAACJ,GAAD,EAAMK,IAAN,EAAe;AACxCM,gBAAQC,GAAR,CAAYpB,IAAIkB,IAAhB;AACA,YAAIV,GAAJ,EAAS;AACLP,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBP,GAArB;AACH;AACD,YAAIK,IAAJ,EAAU;AACL,gBAAI+B,kBAAkB/B,KAAKuB,eAAL,CAAqBI,MAArB,CAA6B;AAAA,uBAAkBC,eAAeP,GAAf,IAAsBlC,IAAIW,MAAJ,CAAW+B,SAAnD;AAAA,aAA7B,CAAtB;AACAE,4BAAgB,CAAhB,EAAmBC,WAAnB,GAAiC7C,IAAIkB,IAAJ,CAAS2B,WAAT,IAAwBD,gBAAgB,CAAhB,EAAmBC,WAA5E;AACAD,4BAAgB,CAAhB,EAAmBE,WAAnB,GAAiC9C,IAAIkB,IAAJ,CAAS4B,WAAT,IAAwBF,gBAAgB,CAAhB,EAAmBE,WAA5E;AACAF,4BAAgB,CAAhB,EAAmBG,MAAnB,GAA4B/C,IAAIkB,IAAJ,CAAS6B,MAAT,IAAmBH,gBAAgB,CAAhB,EAAmBG,MAAlE;AACAH,4BAAgB,CAAhB,EAAmBI,GAAnB,GAAyBhD,IAAIkB,IAAJ,CAAS8B,GAAT,IAAgBJ,gBAAgB,CAAhB,EAAmBI,GAA5D;;AAEAnC,iBAAKY,IAAL,CAAU,UAACjB,GAAD,EAAMK,IAAN,EAAe;AACtB,oBAAIL,GAAJ,EAAS;AACLP,wBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBP,GAArB;AACH;AACDP,oBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,IAArB;AACH,aALA;AAMJ,SAbD,MAaO;AACHZ,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,+BAArB;AACH;AACJ,KArBD;AAsBH,CAvBD;;AAyBA,IAAMkC,oBAAoB,SAApBA,iBAAoB,CAACjD,GAAD,EAAMC,GAAN,EAAc;AACpCR,SAAKiB,QAAL,CAAcV,IAAIW,MAAJ,CAAWC,EAAzB,EAA6B,UAACJ,GAAD,EAAMK,IAAN,EAAe;AACxCM,gBAAQC,GAAR,CAAYpB,IAAIkB,IAAhB;AACA,YAAIV,GAAJ,EAAS;AACLP,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBP,GAArB;AACH;AACD,YAAIK,IAAJ,EAAU;AACN,gBAAIqC,eAAgBrC,KAAKuB,eAAL,CAAqBe,SAArB,CAAgC;AAAA,uBAAkBV,eAAeP,GAAf,IAAsBlC,IAAIW,MAAJ,CAAW+B,SAAnD;AAAA,aAAhC,CAApB;AACA,mBAAO7B,KAAKuB,eAAL,CAAqBc,YAArB,CAAP;AACA;AACA;AACA;AACA;;AAEArC,iBAAKY,IAAL,CAAU,UAACjB,GAAD,EAAMK,IAAN,EAAe;AACrB,oBAAIL,GAAJ,EAAS;AACLP,wBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBP,GAArB;AACH;AACDP,oBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,IAArB;AACH,aALD;AAMH,SAdD,MAcO;AACHZ,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,+BAArB;AACH;AACJ,KAtBD;AAuBH,CAxBD;;AA0BAlB,OAAOuD,GAAP,CAAW,GAAX,EAAgBrD,QAAhB;AACAF,OAAOuD,GAAP,CAAW,MAAX,EAAmB3C,OAAnB;AACAZ,OAAOwD,IAAP,CAAY,GAAZ,EAAiBrC,UAAjB;AACAnB,OAAOyD,GAAP,CAAW,MAAX,EAAoB5B,QAApB;AACA7B,OAAO0D,MAAP,CAAc,MAAd,EAAsBzB,UAAtB;AACAjC,OAAOwD,IAAP,CAAY,iBAAZ,EAA+BlB,gBAA/B;AACAtC,OAAOuD,GAAP,CAAW,eAAX,EAA4Bd,eAA5B;AACAzC,OAAOuD,GAAP,CAAW,0BAAX,EAAuCb,cAAvC;AACA1C,OAAO2D,KAAP,CAAa,0BAAb,EAAyCb,gBAAzC;AACA9C,OAAO0D,MAAP,CAAc,0BAAd,EAA0CN,iBAA1C;;AAEAQ,OAAOC,OAAP,GAAiB7D,MAAjB","file":"Users.js","sourcesContent":["const express = require('express')\n// const _ = require('lodash')\nconst User = require('../models/user')\nconst encrypter = require('../services/encrypter')\nconst errorManager = require('../helpers/request-api-error')\nconst passwordGenerator = require('../services/password-generator')\n\nconst router = express.Router()\n\nconst getUsers = (req, res) => {\n    User.find()\n        .then(result => res.json(result))\n        .catch(err => errorManager.error500(res, err))\n}\n\nconst getUser = (req, res) => {\n    User.findById(req.params.id, (err, user) => {\n        if (err) {\n            res.status(500).send(err)\n        }\n        if (user) {\n            res.status(200).send(user)\n        } else {\n            res.status(404).send(\"No user found with that ID\")\n        }\n    });\n}\n\nconst createUser = (req, res) => {\n    const p = req.body\n    if(req) console.log(req.body)\n    const password = passwordGenerator.generatePassword(10)\n    p.password = encrypter.encrypt(password)\n    const newUser = new User(p)\n    newUser.save().then((user) => {\n        res.json(user)\n    }).catch(err => errorManager.error500(res, err))\n}\n\nconst editUser = (req, res) => {\n    User.findById(req.params.id, (err, User) => {\n        if (err) {\n            res.status(500).send(err);\n        } else {\n            User.name = req.body.name || user.name;\n            User.email = req.body.email || user.email;\n            User.password = req.body.password || user.password;\n\n            User.save((err, pokemon) => {\n                if (err) {\n                    res.status(500).send(err)\n                }\n                res.status(200).send(pokemon);\n            });\n        }\n    })\n}\n\nconst deleteUser = (req, res) => {\n    User.findByIdAndRemove(req.params.id, (err, user) => {\n        let response = {\n            message: \"User successfully deleted\",\n            id: user._id\n        };\n        res.status(200).send(response);\n    });\n}\n\nconst addPokemonToUser = (req, res) => {\n    const p = req.body\n    User.findById(req.params.id, (err, User) => {\n        if (err) {\n            res.status(500).send(err);\n        } else {\n            User.pokemonsCapture.push(req.body.pokemonsCapture)\n            User.save((err, pokemon) => {\n                if (err) {\n                    res.status(500).send(err)\n                }\n                res.status(200).send(pokemon);\n            });\n        }\n    }).catch(err => errorManager.error500(res, err))\n}\n\nconst getPokemonsUser = (req, res) => {\n    User.findById(req.params.id, (err, user) => {\n        if (err) {\n            res.status(500).send(err)\n        }\n        if (user) {\n            res.status(200).send(user.pokemonsCapture)\n        } else {\n            res.status(404).send(\"No pokemon found with that ID\")\n        }\n    });\n}\nconst getPokemonUser = (req, res) => {\n    User.findById(req.params.id, (err, user) => {\n        if (err) {\n            res.status(500).send(err)\n        }\n        if (user) {\n            res.status(200).send(user.pokemonsCapture.filter( pokemonCapture => pokemonCapture._id == req.params.idpokemon))\n        } else {\n            res.status(404).send(\"No pokemon found with that ID\")\n        }\n    });\n}\n\nconst patchPokemonUser = (req, res) => {\n    User.findById(req.params.id, (err, user) => {\n        console.log(req.body)\n        if (err) {\n            res.status(500).send(err)\n        }\n        if (user) {\n             let pokemonToChange = user.pokemonsCapture.filter( pokemonCapture => pokemonCapture._id == req.params.idpokemon)\n             pokemonToChange[0].pokemonName = req.body.pokemonName || pokemonToChange[0].pokemonName;\n             pokemonToChange[0].pokemonType = req.body.pokemonType || pokemonToChange[0].pokemonType;\n             pokemonToChange[0].niveau = req.body.niveau || pokemonToChange[0].niveau;\n             pokemonToChange[0].img = req.body.img || pokemonToChange[0].img;\n\n             user.save((err, user) => {\n                if (err) {\n                    res.status(500).send(err)\n                }\n                res.status(200).send(user);\n            });\n        } else {\n            res.status(404).send(\"No pokemon found with that ID\")\n        }\n    });\n}\n\nconst deletePokemonUser = (req, res) => {\n    User.findById(req.params.id, (err, user) => {\n        console.log(req.body)\n        if (err) {\n            res.status(500).send(err)\n        }\n        if (user) {\n            let indexPokemon =  user.pokemonsCapture.findIndex( pokemonCapture => pokemonCapture._id == req.params.idpokemon)\n            delete user.pokemonsCapture[indexPokemon]\n            // pokemonToChange[0].pokemonName = req.body.pokemonName || pokemonToChange[0].pokemonName;\n            // pokemonToChange[0].pokemonType = req.body.pokemonType || pokemonToChange[0].pokemonType;\n            // pokemonToChange[0].niveau = req.body.niveau || pokemonToChange[0].niveau;\n            // pokemonToChange[0].img = req.body.img || pokemonToChange[0].img;\n\n            user.save((err, user) => {\n                if (err) {\n                    res.status(500).send(err)\n                }\n                res.status(200).send(user);\n            });\n        } else {\n            res.status(404).send(\"No pokemon found with that ID\")\n        }\n    });\n}\n\nrouter.get('/', getUsers)\nrouter.get('/:id', getUser)\nrouter.post('/', createUser)\nrouter.put('/:id',  editUser)\nrouter.delete('/:id', deleteUser)\nrouter.post('/:id/addPokemon', addPokemonToUser)\nrouter.get('/:id/pokemons', getPokemonsUser)\nrouter.get('/:id/pokemons/:idpokemon', getPokemonUser)\nrouter.patch('/:id/pokemons/:idpokemon', patchPokemonUser)\nrouter.delete('/:id/pokemons/:idpokemon', deletePokemonUser)\n\nmodule.exports = router"]}